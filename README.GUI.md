# Ark-Tools GUI 使用指南

## 概述

Ark-Tools GUI 是一个图形用户界面，为 Ark-Tools 的所有功能提供了易于使用的交互式界面。通过标签页的形式，您可以方便地访问各个功能模块。

## 系统要求

- Python 3.12 或更高版本
- tkinter（Python标准库，某些Linux系统可能需要单独安装）
- 所有 Ark-Tools 的依赖包

### Linux系统安装tkinter

如果在Linux系统上遇到 `ModuleNotFoundError: No module named 'tkinter'` 错误，请安装tkinter：

```bash
# Ubuntu/Debian
sudo apt-get install python3-tk

# Fedora
sudo dnf install python3-tkinter

# Arch Linux
sudo pacman -S tk
```

## 启动GUI

有两种方式启动GUI：

### 方法1: 直接运行启动脚本

```bash
python run_gui.py
```

### 方法2: 使用PDM运行

```bash
pdm run python run_gui.py
```

## 功能标签页

### 📥 资源下载

该标签页用于检查游戏版本更新并下载资源文件。

**功能说明：**

1. **版本信息显示**
   - 本地版本：显示当前已下载的资源版本
   - 最新版本：显示游戏服务器上的最新版本

2. **检查更新按钮**
   - 点击检查更新按钮，程序会连接游戏服务器获取最新版本信息
   - 如果有新版本，"开始下载"按钮会被启用

3. **下载选项**
   - "下载所有资源"：勾选后会下载所有资源，而不仅仅是差分更新

4. **下载操作**
   - 点击"开始下载"按钮开始下载资源
   - 进度条会显示下载状态
   - 下载日志会实时显示下载信息

**使用流程：**
1. 点击"检查更新"按钮
2. 等待版本检查完成
3. 如果有更新，点击"开始下载"
4. 等待下载完成

---

### 📦 资源解包

该标签页用于从Unity Asset Bundle文件中提取资源。

**功能说明：**

1. **文件选择**
   - 点击"浏览..."按钮选择要解包的文件
   - 支持各种Unity资源包格式

2. **输出目录**
   - 指定解包后资源的保存位置
   - 默认为 `output/unpacked` 目录

3. **解包选项**
   - 提取纹理(Texture2D)：提取游戏中的纹理图片
   - 提取精灵(Sprite)：提取精灵图片
   - 提取数据(MonoBehaviour)：提取脚本数据

4. **解包操作**
   - 选择好文件和选项后，点击"开始解包"
   - 进度条显示解包进度
   - 解包日志显示详细信息

**使用流程：**
1. 点击"浏览..."选择要解包的文件
2. 确认或修改输出目录
3. 选择需要的解包选项
4. 点击"开始解包"
5. 等待解包完成

---

### 🎨 立绘导出

该标签页用于导出角色立绘和差分表情。

**功能说明：**

1. **输入目录**
   - 选择解包后的资源目录
   - 默认为 `output/unpacked` 目录

2. **输出目录**
   - 指定立绘导出的保存位置
   - 默认为 `output/chararts` 目录

3. **导出选项**
   - 导出带遮罩版本：生成带遮罩效果的立绘
   - 导出无遮罩版本：生成不带遮罩的立绘

4. **导出操作**
   - 点击"开始导出"按钮开始处理
   - 程序会自动合成立绘和差分表情
   - 导出日志显示处理进度

**使用流程：**
1. 确认输入目录包含解包后的立绘资源
2. 设置输出目录
3. 选择导出选项
4. 点击"开始导出"
5. 等待处理完成

---

### 😊 表情生成

该标签页用于生成角色表情差分展示卡片。

**功能说明：**

1. **输入目录**
   - 选择包含立绘差分的目录
   - 默认为 `output/chararts` 目录

2. **输出目录**
   - 指定表情卡片的保存位置
   - 默认为 `output/face_cards` 目录

3. **生成选项**
   - 启用超分处理（RealCUGAN）：使用AI超分辨率提升图片质量
   - 启用背景模糊：为卡片添加高斯模糊背景
   - 网格列数：设置表情在卡片上的排列列数（3-6列）

4. **生成操作**
   - 点击"生成表情卡片"开始处理
   - 程序会自动排列表情差分
   - 生成日志显示处理进度

**使用流程：**
1. 确认输入目录包含立绘差分文件
2. 设置输出目录
3. 配置生成选项（超分、模糊、列数）
4. 点击"生成表情卡片"
5. 等待处理完成

**注意事项：**
- 启用超分处理需要RealCUGAN工具
- 超分处理会显著增加处理时间，但能提升图片质量

---

### 🎵 音频可视化

该标签页用于创建音频频谱可视化视频。

**功能说明：**

1. **音频文件选择**
   - 点击"浏览..."选择音频文件
   - 支持 MP3, WAV, FLAC, OGG 等格式

2. **背景图片（可选）**
   - 选择一张图片作为视频背景
   - 如果不选择，会使用默认背景

3. **输出视频文件**
   - 指定生成的视频文件保存路径
   - 默认为 `output/visualizer.mp4`

4. **可视化选项**
   - 视频标题：显示在视频中的标题文字

5. **生成操作**
   - 点击"生成可视化视频"开始处理
   - 程序会分析音频并生成频谱动画
   - 处理日志显示进度

**使用流程：**
1. 选择音频文件
2. （可选）选择背景图片
3. 设置输出文件路径
4. 输入视频标题
5. 点击"生成可视化视频"
6. 等待处理完成

**输出格式：**
- 分辨率：1920x1080
- 帧率：60 FPS
- 格式：MP4

---

### ⚙️ 设置

该标签页用于配置全局设置。

**功能说明：**

1. **路径设置**
   - 数据目录：存储游戏数据和缓存的位置
   - 下载目录：资源下载的保存位置

2. **API设置**
   - 服务器：选择资源下载源
     - `officialAndroid`：官方Android服务器
     - `officialIOS`：官方iOS服务器
     - `bilibili`：B站服务器

3. **操作按钮**
   - 保存设置：保存当前配置
   - 重置默认：恢复所有设置为默认值

4. **关于信息**
   - 显示软件版本、作者和许可证信息

**使用建议：**
- 首次使用前建议检查路径设置
- 根据网络情况选择合适的服务器
- 定期清理数据目录中的缓存文件

---

## 常见问题

### Q: GUI无法启动，提示找不到tkinter模块

**A:** 在某些Linux发行版中，tkinter需要单独安装。请参考上面的"系统要求"部分安装tkinter。

### Q: 下载资源时遇到网络错误

**A:**
1. 检查网络连接是否正常
2. 尝试切换到其他服务器（在设置标签页中）
3. 检查防火墙设置

### Q: 解包或导出时出错

**A:**
1. 确认输入文件/目录存在且完整
2. 检查是否有足够的磁盘空间
3. 查看日志获取详细错误信息

### Q: 超分处理失败

**A:**
1. 确认已安装RealCUGAN工具
2. 检查RealCUGAN路径配置是否正确
3. 确认有足够的系统资源（内存、显存）

### Q: 音频可视化生成失败

**A:**
1. 确认音频文件格式正确且未损坏
2. 检查是否安装了所有必要的依赖（librosa, moviepy等）
3. 确认有足够的磁盘空间

---

## 技术说明

### GUI框架
- 使用Python标准库 `tkinter` 构建
- 采用 `ttk` 主题组件提供现代化界面
- 使用线程处理长时间运行的任务，避免界面卡顿

### 异步处理
- 所有长时间运行的操作都在后台线程中执行
- 使用进度条显示任务进度
- 日志实时更新显示任务状态

### 目录结构
```
output/
├── unpacked/       # 解包后的资源
├── chararts/       # 导出的立绘
├── face_cards/     # 表情卡片
└── visualizer.mp4  # 音频可视化视频
```

---

## 未来改进计划

- [ ] 添加批量处理功能
- [ ] 支持自定义主题
- [ ] 添加任务队列管理
- [ ] 支持暂停/恢复下载
- [ ] 添加资源预览功能
- [ ] 优化大文件处理性能
- [ ] 添加多语言支持
- [ ] 集成更多图像处理选项

---

## 反馈与贡献

如果您在使用过程中遇到问题或有改进建议，欢迎：

1. 提交Issue到GitHub仓库
2. 贡献代码（Pull Request）
3. 分享您的使用经验

---

## 许可证

本项目基于 MIT License 开源。
